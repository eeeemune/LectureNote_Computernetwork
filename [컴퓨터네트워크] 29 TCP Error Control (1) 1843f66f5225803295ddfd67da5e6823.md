# [ì»´í“¨í„°ë„¤íŠ¸ì›Œí¬] 29. TCP Error Control (1)

<aside>

# ğŸ’– TCP Error Control

</aside>

ì˜¤ë¥˜ë¡œ ì¸í•´ packetì´ ë„ì°©í•˜ì§€ ì•Šì•˜ì„ ê²½ìš°, ì´ê±¸ senderë‚˜ recieverê°€ ì•Œì•„ì„œ í•´ê²°í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì•¼ reliableí•œ ì „ì†¡ì´ë¼ê³  í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## TCPì˜ Error Control ê¸°ë²•

1. Checksum
2. Acksowledgement
3. TImeout

<aside>

**ì¤‘ê°„ì— packetì´ ì‚¬ë¼ì§„ ê²½ìš°ì— ë²ˆí˜¸ë¥¼ ì±„ìš¸ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ê³  í•˜ì‹¬. ëŒ€ë†“ê³  ì‹œí—˜ë¬¸ì œ ì£¼ì‹  ë“¯,,, íŠ¹íˆ Timeout ìœ„ì£¼ë¡œ !! !!**

</aside>

## Senderì˜ error control

### ì–¸ì œ ë°œìƒí•˜ë‚˜ìš”?

ìš°ì„ , senderê°€ actionì„ ì·¨í•  ê²½ìš°ì˜ ìˆ˜ëŠ” ë‹¤ìŒì˜ ì„¸ ê°€ì§€ë¡œ ì¶”ë ¤ì§‘ë‹ˆë‹¤.

- **application layerë¡œë¶€í„° ë°ì´í„°ê°€ ë„ì°©**í–ˆì„ ë•Œ
    - ì´ ê²½ìš° TCPì˜ í•˜ìœ„ layerì¸ `IP` layerì— dataë¥¼ ë³´ë‚´ê²Œ ë©ë‹ˆë‹¤.
    - **ì´ ë•Œ timerë¥¼ ì‹œì‘í•˜ê²Œ ë©ë‹ˆë‹¤.**
- **receiverë¡œë¶€í„° `ACK`ê°€ ë„ì°©**í–ˆì„ ë•Œ
- timeoutì´ ë°œìƒí–ˆì„ ë•Œ
    - ë­”ê°€ ì˜ëª»ëë‹¤ëŠ” ì‹ í˜¸ì´ë¯€ë¡œ segmentë¥¼ retransmití•˜ê²Œ ë©ë‹ˆë‹¤.
    - ê·¸ë¦¬ê³  **timerë¥¼ ë‹¤ì‹œ ì‹œì‘**í•˜ê²Œ ë©ë‹ˆë‹¤.

## ACK Generation ê·œì¹™ë“¤

<aside>

**ì´ ruleë“¤ì„ ìµœëŒ€í•œ ê¸°ì–µí•´ì•¼ í•œë‹¤ê³  ë§ì”€í•˜ì‹¬. ë¬¸ì¥ìœ¼ë¡œ ì™¸ìš°ëŠ” ê²Œ ì•„ë‹ˆë¼ ìƒí™©ì„ ì˜ˆì‹œë¡œ ë§Œë“¤ì–´ì„œ ì—°ìŠµí•˜ë¼ê³  ë§ì”€í•˜ì‹¬**

</aside>

1. ë°ì´í„°ë¥¼ ë³´ë‚¼ ë•ŒëŠ” ë°˜ë“œì‹œ ACK í”¼ë“œë°±ì„ í•  ê²ƒ
2. delayed ACK
    
    ë³´ë‚¼ ë°ì´í„°ë„ ë”±íˆ ì—†ê³  ìˆœì„œëŒ€ë¡œ packetë„ ì˜ ë„ì°©í•˜ê³  ìˆì„ ë•Œ, ì´ì „ packetì— ackë¥¼ ë³´ëƒˆë‹¤ë©´ ë‘ ë²ˆì§¸ packetì€ ack ì•ˆ ë³´ë‚¼ ê²ƒ
    
    - ë‹¤ìŒ packetì´ 500ms ì´ë‚´ì— ë„ì°©í–ˆë‹¤ë©´ !! !!
    - ì´ ruleì„ í†µí•´ silly sending ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŒ
3. ì—°ì†ì ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜ segmentë¥¼ ë°›ì•˜ì„ ë•Œë„ í•œ ê°œì˜ ACKë§Œ ë³´ë‚¼ ê²ƒ
4. **out-of-orderì¸ segmentê°€ ë„ì°©**í–ˆì„ ê²½ìš°
    1. ê¸°ëŒ€ë³´ë‹¤ ë” í° ê°’ì˜ segmentê°€ ë„ì°©í–ˆë‹¤ë©´, ì¤‘ê°„ì— missing segmentê°€ ë°œìƒí–ˆë‹¤ëŠ” ì˜ë¯¸
    2. ì´ ë•ŒëŠ” ë°”ë¡œ ackë¥¼ ë³´ëƒ„
    3. ê·¸ë˜ì„œ **ì´ ë•ŒëŠ” ì—¬ëŸ¬ ê°œì˜ ACKë¥¼ ë³´ë‚¼ ìˆ˜ ìˆìŒ**
        1. ì´ë¥¼ `duplicate ACK`ë¼ê³  í‘œí˜„í•¨
5. missing segmentê°€ ë„ì°©í–ˆë‹¤ë©´ ìƒˆ ì‹œí€€ìŠ¤ ë²ˆí˜¸ë¥¼ ê¸°ë‹¤ë¦°ë‹¤ëŠ” ackë¥¼ ì¦‰ì‹œ ë³´ëƒ„
6. ì¤‘ë³µ segmentê°€ ë„ì°© ì‹œ íê¸°í•˜ë˜, ì¦‰ì‹œ ëˆ„ì  ackë¥¼ ë³´ëƒ„
    1. **ê¸°ì¡´ì— ë‚´ê°€ ackë¥¼ ë³´ëƒˆë˜ ê²Œ ì†ì‹¤ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸**ì´ê¸° ë•Œë¬¸

## Error Control Scenario

### 1. Normal Operation

<aside>

**ë‹¤ìŒì˜ ê·¸ë¦¼ì„ ë³´ê³ , ì™œ 500ë³´ë‹¤ ë¹ ë¥´ê²Œ stopë˜ì—ˆëŠ”ì§€ ì„¤ëª…í•˜ì‹œì˜¤**

- **rule 3ì— ì˜í•´ì„œ ê·¸ë ‡ê²Œ ë¨â€¦ ë“±ìœ¼ë¡œ ëŒ€ë‹µ**
</aside>

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image.png)

1. Rule 3: ìˆœì„œëŒ€ë¡œ ìˆ˜ì‹ í–ˆë‹¤ë©´, 2ê°œ ì´ìƒ un-ACKedí•˜ì§€ ì•Šì„ ê²ƒ

### 2. Lost Segment

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%201.png)

1. ì²«ë²ˆì§¸ `ACK: 701`ì¼ ë•Œ, ìˆœì„œëŒ€ë¡œ 2ê°œì˜ segmentë¥¼ ìˆ˜ì‹ í•˜ì˜€ìœ¼ë¯€ë¡œ ackë¥¼ ë‘ ê°œ ë³´ë‚´ëŠ” ê²Œ ì•„ë‹ˆë¼ í•œ ê°œë§Œ ë³´ëƒ„
    1. Rule 3: ìˆœì„œëŒ€ë¡œ ìˆ˜ì‹ í–ˆë‹¤ë©´, 2ê°œ ì´ìƒ un-ACKedí•˜ì§€ ì•Šì„ ê²ƒ
2. ë‘ ë²ˆì§¸ `ACK: 701` ì—ì„œ, out of orderì¸ segmentê°€ ë„ì°©í•˜ì˜€ìœ¼ë¯€ë¡œ **ì¦‰ì‹œ Ack ì „ì†¡**í•¨
    1. Rule 4: unordered segmentê°€ ë„ì°©í–ˆì„ ë•Œ ì¦‰ì‹œ ack
3. ì„¸ ë²ˆì§¸ `ACK: 901`ì—ì„œ, **ëˆ„ë½ì´ ë©”ê¿”ì¡Œìœ¼ë¯€ë¡œ ì¦‰ì‹œ ackë¥¼ ë³´ëƒ„**
    1. Rule 5: ì†ì‹¤ëœ segmentê°€ ë„ì°©í–ˆì„ ë•Œ ì¦‰ì‹œ ack

### 3. Lost ACK corrected by resending a segment

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%202.png)

- `client` ì…ì¥ì—ì„œëŠ” **ackê°€ ë„ì°©í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ê°™ì€ íŒ¨í‚·ì„ ë‹¤ì‹œ** ë³´ëƒ„
- `server` ì…ì¥ì—ì„œ, ê°™ì€ íŒ¨í‚·ì´ ë‘ ë²ˆ ë„ì°©í•¨
    - rule 6: **ê°™ì€ íŒ¨í‚·ì´ ë‘ ë²ˆ ë„ì°©í•˜ë©´ ê·¸ëƒ¥ ë¬´ì‹œ**í•˜ë˜, **ì¦‰ì‹œ ACK**ë¥¼ ë³´ëƒ„

### 4. Fast Retransmission

ë³´í†µì˜ Internetì—ì„œëŠ” ê°™ì€ ackê°€ ë„¤ ë²ˆ ë„ì°©í–ˆì„ ë•Œ ê·¸ê±¸ ë‹¤ì‹œ ë³´ëƒ…ë‹ˆë‹¤ !! !!

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%203.png)

ì´ë ‡ê²Œ, **ì„¸ ë²ˆ ì¤‘ì²©ë˜ì–´ retransmission**ì´ ì¼ì–´ë‚  ë•Œ segmentë¥¼ re-sentí•œë‹¤ !! !!

- ì´ ìƒí™©ì´ ì‹œí—˜ì— ë‚˜ì˜¤ë‚˜ ë³´ë‹¤,,, ë˜ê²Œ ì˜ë¯¸ì‹¬ì¥í•˜ê²Œ ë§ì”€í•˜ì‹¬

### 5. Lost ACK

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%204.png)

## Retransmission Timeout ì„¤ì •

RTOë¥¼ ëª‡ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²Œ ê°€ì¥ ì¢‹ì„ê¹Œ?ì— ê´€í•œ ë¬¸ì œ,,,

- ê²°êµ­ ì¤‘ìš”í•œ ê²ƒì€ RTTì´ë‹¤.
    - RTT: Round Trip Time
- RTTë¥¼ ì¶”ì •í•˜ëŠ” ê³µì‹ ì´ìš©. ì´ ê³µì‹ì€ í†µê³„í•™ì— ì˜í•´ ì•Œë ¤ì ¸ ìˆë‹¤.
- SmoothedRTT = (1- ï¡)*SmoothedRTT + ï¡*MeasuredRTT
    - ë³µì¡í•˜ê²Œ ìƒê²¼ì§€ë§Œ, ê²°êµ­ ì¼ì¢…ì˜ í‰ê· ì„ ê³„ì‚°í•œ ê²ƒ
    - ê·¸ëƒ¥ í‰ê· ì„ ë‚¸ ê²Œ ì•„ë‹ˆë¼ ë‹¤ì¤‘ í‰ê· ì„ ë‚¸ ê±°ë¼ëŠ”ë° ë­” ì†Œë¦¬ì¸ì§€ ëª¨ë¥´ê² ë‹¤ ì”¨ì´ë°œ ì§„ì§œ !!!!!!!!!!!!!!!!!!!!!!!!!!

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%205.png)

### 1. NaÃ¯ve Round-Trip Time (RTT) Estimation

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%206.png)

![image.png](%5B%E1%84%8F%E1%85%A5%E1%86%B7%E1%84%91%E1%85%B2%E1%84%90%E1%85%A5%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%5D%2029%20TCP%20Error%20Control%20(1)%201843f66f5225803295ddfd67da5e6823/image%207.png)

### 2. SmoothedRTT Estimation

<aside>

SmoothedRTT = (1- Î±) * SmoothedRTT *+* Î± * MeasuredRTT

</aside>

- Typical value of Î± = 0.125

### 3. RTT Variation Estimation

<aside>

RTTVAR = (1-Î²) * RTTVAR *+* Î² * | MeasuredRTT-SmoothedRTT |

</aside>

- Typical value of Î² = 0.25

## TCPâ€™s RTO Computation Algorithm

<aside>

RTO = SmoothedRTT + max(G, K*RTTVAR)

</aside>

ê·¸ëƒ¥ ì•„ë˜ì™€ ê°™ì´ ê¸°ì–µí•˜ë¼ê³  ë§ì”€í•˜ì‹¬

<aside>

RTO = 4*RTTVAR

</aside>

ê³µì‹ ì™¸ìš¸ í•„ìš” ì—†ë‹¤ê³  í•˜ì‹¬. ê³„ì‚°í•˜ëŠ” ë¬¸ì œ ë‚˜ì˜¨ë‹¤ë©´ ê³µì‹ ë‹¤ ì¨ì£¼ê² ë‹¤ê³  ë§ì”€í•˜ì‹¬

# ğŸ’– Referneces

https://velog.io/@hsshin0602/%EC%BB%B4%ED%93%A8%ED%84%B0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-TCP-Timer

https://florescene.tistory.com/149